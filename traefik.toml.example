# ==============================================
# Traefik 配置文件
# 用于自动 HTTPS 和反向代理
# ==============================================

# 全局配置
[global]
  checkNewVersion = true
  sendAnonymousUsage = false

# 日志配置
[log]
  level = "INFO"
  format = "common"

# 访问日志
[accessLog]
  format = "common"
  
# API 和 Dashboard 配置
[api]
  dashboard = true
  insecure = false

# 入口点配置
[entryPoints]
  # HTTP 入口 (端口 80)
  [entryPoints.web]
    address = ":80"
    # 自动重定向到 HTTPS
    [entryPoints.web.http]
      [entryPoints.web.http.redirections]
        [entryPoints.web.http.redirections.entryPoint]
          to = "websecure"
          scheme = "https"
          permanent = true

  # HTTPS 入口 (端口 443)
  [entryPoints.websecure]
    address = ":443"
    [entryPoints.websecure.http]
      [entryPoints.websecure.http.tls]
        certResolver = "letsencrypt"

# Let's Encrypt 自动证书配置
[certificatesResolvers.letsencrypt.acme]
  email = "1186765234@qq.com"  # 修改为你的邮箱
  storage = "/letsencrypt/acme.json"
  
  # 使用 HTTP 验证 (推荐)
  [certificatesResolvers.letsencrypt.acme.httpChallenge]
    entryPoint = "web"
  
  # 或使用 DNS 验证 (需要配置 DNS 提供商)
  # [certificatesResolvers.letsencrypt.acme.dnsChallenge]
  #   provider = "cloudflare"
  #   delayBeforeCheck = 0

# Docker 提供商配置
[providers.docker]
  endpoint = "unix:///var/run/docker.sock"
  exposedByDefault = false
  network = "app-network"
  watch = true

# 文件提供商配置 (可选，用于静态路由)
[providers.file]
  directory = "/etc/traefik/dynamic"
  watch = true
